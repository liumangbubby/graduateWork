<?xml version="1.0" encoding="UTF-8"?>

 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="Exam">
	<typeAlias alias="Exam" type="cn.gov.jyw.pojo.exam" />
	<typeAlias alias="ExamChoose" type="cn.gov.jyw.pojo.exam_choose" />


	<resultMap class="Exam" id="ExamResult" groupBy="exam.exam_id">
		<result property="exam_id" column="exam_id" />
		<result property="exam_no" column="exam_no" />
		<result property="exam_type" column="exam_type" />
		<result property="exam_mappingno" column="exam_mappingno" />
		<result property="exam_body" column="exam_body" />
		<result property="body_img" column="body_img" />
		<result property="exam_class" column="exam_class" />
		<result property="answer_info" column="answer_info" />
		<!--  
		<result property="chooses" column="exam_id" select="getChooses" />
		-->
		<result property="chooses" resultMap="Exam.ChooseResult"/>
	</resultMap>


	<resultMap class="ExamChoose" id="ChooseResult" groupBy="chooses.choose_id">
		<result property="choose_id" column="choose_id" />
		<result property="exam_id" column="exam_id" />
		<result property="choose_body" column="choose_body" />
		<result property="right_answer_flag" column="right_answer_flag" />
		<result property="choose_img" column="choose_img" />
	</resultMap>
	
	<resultMap class="Exam" id="ExamResult2" groupBy="exam.exam_id">
		<result property="exam_id" column="exam_id" />
		<result property="exam_no" column="exam_no" />
		<result property="exam_type" column="exam_type" />
		<result property="exam_mappingno" column="exam_mappingno" />
		<result property="exam_body" column="exam_body" />
		<result property="body_img" column="body_img" />
		<result property="exam_class" column="exam_class" />
		<result property="answer_info" column="answer_info" />
		<!--  
		<result property="chooses" column="exam_id" select="getChooses" />
		-->
	</resultMap>


	<select id="getExam" resultMap="ExamResult" parameterClass="int">
		select * from exam where exam.exam_id = #id#
	</select>
	
	<select id="getExam2" resultMap="ExamResult" parameterClass="int">
		select
			exam.*,chooses.*
		from
			exam left join exam_choose chooses on exam.exam_id = chooses.exam_id
		where
			exam.exam_id = #id#
	</select>
	
	<select id="queryAll" resultMap="ExamResult2" parameterClass="java.util.Map">
		select * from exam
		<dynamic prepend="order by" close=" ">
			<isEqual property="order" compareValue="1">
				exam_id asc
			</isEqual>
			<isEqual property="order" compareValue="2">
				exam_id desc
			</isEqual>
		</dynamic>
		limit #start#,#limit#
	</select>
	
	<select id="getExam3" resultMap="ExamResult" parameterClass="java.util.Map">
		select
			exam.*,chooses.*
		from
			exam left join exam_choose chooses on exam.exam_id = chooses.exam_id
		<dynamic prepend="where">
			<isNotNull prepend="and" property="id">
				exam.exam_id = #id#
			</isNotNull>
			<isNotNull prepend="and" property="examclass">
				exam.exam_class = #examclass#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getChooses" resultMap="ChooseResult" parameterClass="int">
		select choose_id,exam_id,choose_body,right_answer_flag,choose_img from exam_choose where
		exam_id = #value#
	</select>
	
	<select id="checkAnswer" resultClass="int" parameterClass="java.util.Map">
		select 1 from exam_choose where
			exam_id = #examid# 
		and 
			right_answer_flag = #answer#
	</select>
	
	<select id="getExamCount" resultClass="long">
		select count(*) from exam
	</select>
	
	<delete id="deleteExam" parameterClass="List">
		delete from exam where exam_id in (
		<iterate conjunction="," >
			#[]#
		</iterate>
		)
	</delete>
</sqlMap>
	